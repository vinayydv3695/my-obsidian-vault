



---

# ## 1. Creating & Dropping Databases and Collections

### **MongoDB creates DBs & collections implicitly**

Switch DB:

```
use mydb
```

Create a collection implicitly via insert:

```
db.users.insertOne({ name: 'Alice' })
```

### **Drop collection**

```
db.users.drop()
```

### **Drop database**

```
db.dropDatabase()
```

### **Explicit creation examples**

```
use onlineShopDB
db.createCollection('products')
db.createCollection('users')
db.products.insertOne({ name: 'Laptop', price: 1000 })
db.products.drop()
db.dropDatabase()
```

---

# ## 2. Insert Operations

### **insertOne()**

```
db.collection.insertOne({ ... })
```

### **insertMany()**

```
db.movies.insertMany([
  { _id: 0, title: "M1" },
  { _id: 1, title: "M2" },
  { _id: 1, title: "M3" }, // ERROR: duplicate _id
  { _id: 2, title: "M4" }
])
```

MongoDB **stops on the first error** unless ordered:false.

### **Unordered insert**

```
db.movies.insertMany([...], { ordered: false })
```

---

# ## 3. Insert Validation (Schema Validation)

MongoDB supports **JSON Schema validation**.

### **Example:**

```
db.createCollection('products', {
  validator: {
    $jsonSchema: {
      bsonType: 'object',
      required: ['name', 'price'],
      properties: {
        name: { bsonType: 'string' },
        price: { bsonType: 'number', minimum: 0 }
      }
    }
  }
})
```

Then:

```
db.products.insertMany([
  { name: 'Phone', price: 500 },
  { name: 'Tablet', price: 800 }
])
```

---

# ## 4. Query, Update, Delete, Upserts

### **Query**

```
db.users.find({ age: { $gt: 25 } })
```

### **UpdateOne / UpdateMany**

```
db.users.updateOne({ name: 'Alice' }, { $set: { age: 30 } })
db.users.updateMany({ active: true }, { $inc: { score: 1 } })
```

### **Upsert (insert if not exists)**

```
db.users.updateOne(
  { name: 'Bob' },
  { $set: { age: 22 } },
  { upsert: true }
)
```

### **Delete**

```
db.users.deleteMany({ inactive: true })
```

---

# ## 5. Replace Operation (Useful in Schema Migration)

```
var tmp = db.rc.findOne({ name: "Ankit" })
tmp.relationship = { friends: 10, collegue: 3 }
tmp.username = tmp.name
delete tmp.friends
delete tmp.collegue
delete tmp.name

db.rc.replaceOne({ name: "Ankit" }, tmp)
```

---

# ## 6. $set and $unset

### **Add/Edit field**

```
db.rc.updateOne({ _id: 1 }, { $set: { favBook: "Maths" } })
```

### **Remove field**

```
db.rc.updateOne({ _id: 1 }, { $unset: { favBook: 1 } })
```

---

# ## 7. Array Operations ($push, $pop, $addToSet, $each, $slice)

### **$push — add element**

```
db.rc.updateOne(
  { username: "Ankit" },
  { $push: { Details: { phone: 99999999, email: "Anky@example.com" } } }
)
```

### **$pop — remove last element**

```
db.rc.updateOne({ _id: 1 }, { $pop: { Details: 1 } })
```

### **$addToSet — avoid duplicates**

```
db.users.updateOne(
  { _id: ObjectId("4b2d...") },
  { $addToSet: { emails: "joe@gmail.com" } }
)
```

### **$push with $each**

```
db.stock.ticker.updateOne(
  { _id: 1 },
  { $push: { hourly: { $each: [1, 2, 3] } } }
)
```

### **$slice — limit array size**

Used with `$push` to prevent array from growing endlessly.

---

# ## 8. Cursor Control — find(), limit(), skip(), sort()

### **Examples**

```
db.products.find()
db.products.find().limit(5)
db.products.find().skip(5)
db.products.find().sort({ price: -1 })
db.products.find().sort({ name: 1 }).limit(10).skip(5)
```

---

# --------------------------------------------------------

# # **PART 2 — Indexing Deep Dive**

---

# ## 9. Introduction to Indexing

Indexes improve query performance.  
Without indexes → **COLLSCAN** (full collection scan).

### **Create Index**

```
db.users.createIndex({ email: 1 })
```

### **Unique Index**

```
db.users.createIndex({ username: 1 }, { unique: true })
```

---

# ## 10. Types of Indexes

### **1. Single Field Index**

```
db.users.createIndex({ name: 1 })
```

### **2. Compound Index**

```
db.users.createIndex({ name: 1, age: -1 })
```

### **3. Multikey Index (arrays)**

```
db.inventory.createIndex({ tags: 1 })
```

### **4. Text Index**

```
db.articles.createIndex({ content: 'text' })
```

### **5. Hashed Index**

```
db.records.createIndex({ userId: 'hashed' })
```

### **6. TTL Index**

```
db.logs.createIndex({ createdAt: 1 }, { expireAfterSeconds: 3600 })
```

---

# ## 11. Compound Indexes & Prefix Rule

A compound index:

```
db.orders.createIndex({ customerId: 1, date: -1 })
```

Supports queries on:

- `{ customerId }`
    
- `{ customerId, date }`
    

**Does NOT support:**

- `{ date }` alone
    

---

# ## 12. explain() and hint()

### **Explain Query Execution**

```
db.users.find({ age: { $gt: 30 } }).explain("executionStats")
```

### **Force a specific index**

```
db.users.find({ age: { $gt: 30 } }).hint({ age: 1 })
```

---

# ## 13. Index Administration

### **List Indexes**

```
db.collection.getIndexes()
```

### **Drop Index**

```
db.collection.dropIndex("name_1")
```

### **Rebuild Index**

```
db.collection.reIndex()
```

### **Monitor Performance**

- `db.currentOp()`
    
- Profiler for slow queries
    

---

# ----------------------------------------------------

# ⭐ **20 MCQs

---

### **1. MongoDB creates a database when:**

A) You run createDatabase()  
B) You restart the server  
C) You insert data into it  
D) You enable admin mode  
**Answer: C**

---

### **2. insertMany stops on duplicate _id unless:**

A) ordered: true  
B) ordered: false  
C) unique: false  
D) skipDuplicates: true  
**Answer: B**

---

### **3. JSON Schema validation requires:**

A) mongoConfig.js  
B) $jsonSchema  
C) $validatorOnly  
D) useValidation()  
**Answer: B**

---

### **4. Upsert means:**

A) Update only  
B) Insert only  
C) Insert if not exists, else update  
D) Delete before insert  
**Answer: C**

---

### **5. Which operator increments a numeric field?**

A) $set  
B) $inc  
C) $mul  
D) $add  
**Answer: B**

---

### **6. $unset is used to:**

A) Remove a document  
B) Remove a field  
C) Update multiple docs  
D) Reset validation  
**Answer: B**

---

### **7. $push adds elements to:**

A) Object  
B) Array  
C) Database  
D) Index  
**Answer: B**

---

### **8. $addToSet is preferred over $push when:**

A) Duplicates must be avoided  
B) Performance is critical  
C) Removing from array  
D) Querying indexes  
**Answer: A**

---

### **9. limit() is used to:**

A) Sort results  
B) Restrict number of documents  
C) Skip documents  
D) Remove duplicates  
**Answer: B**

---

### **10. An index improves:**

A) Insertion performance only  
B) Query performance  
C) Storage performance  
D) Update speed only  
**Answer: B**

---

### **11. A compound index follows the:**

A) Shard rule  
B) Array rule  
C) Prefix rule  
D) Sort rule  
**Answer: C**

---

### **12. A multikey index supports:**

A) Null values  
B) Arrays  
C) Deleted documents  
D) BSON only  
**Answer: B**

---

### **13. A TTL index is used to:**

A) Auto-delete after time  
B) Track transactions  
C) Compress documents  
D) Sort automatically  
**Answer: A**

---

### **14. explain() shows:**

A) Database size  
B) CRUD logs  
C) Query execution plan  
D) Index names only  
**Answer: C**

---

### **15. hint() is used to:**

A) Ignore indexes  
B) Force a specific index  
C) Rebuild all indexes  
D) Enable auto-index  
**Answer: B**

---

### **16. dropIndex removes:**

A) All indexes  
B) A specific index  
C) The collection  
D) Validation rules  
**Answer: B**

---

### **17. prefix rule allows queries on:**

A) Last field only  
B) Middle fields  
C) Leftmost fields only  
D) Any field  
**Answer: C**

---

### **18. reIndex() is used for:**

A) Dropping database  
B) Rebuilding all indexes  
C) Flushing cache  
D) Fixing schema  
**Answer: B**

---

### **19. Use $each with:**

A) $unset  
B) $push  
C) $inc  
D) $set  
**Answer: B**

---

### **20. find().sort().skip().limit() is an example of:**

A) Cursor chaining  
B) Schema migration  
C) Aggregation pipeline  
D) Index creation  
**Answer: A**

---

