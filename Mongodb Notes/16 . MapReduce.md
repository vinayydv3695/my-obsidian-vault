
---



# # **1. Meaning of `$` in MongoDB**

MongoDB uses `$` in **three major places**:

---

## **A. `$` as Query Operators**

Used inside filters for comparison and logical operations.

Examples:

```js
{ age: { $gt: 25 } }
{ price: { $in: [100, 200] } }
{ $and: [ { age: {$gt:18} }, { status: "A" } ] }
```

Common operators:

- `$eq`, `$gt`, `$lt`, `$lte`, `$gte`
    
- `$in`, `$nin`
    
- `$and`, `$or`, `$not`
    

---

## **B. `$` as Field References (Aggregation Pipelines)**

Inside aggregation stages like `$project`, `$group`, `$addFields`, MongoDB uses `$field` to represent **the value of the field**.

Example:

```js
{ $project: { city: 1, population: "$pop" } }
```

Here:

- `"pop"` = field name
    
- `"$pop"` = value of the field
    

---

## **C. `$` as Accumulators (Inside `$group`)**

Accumulators compute values during grouping.

Examples:

- `$sum`
    
- `$avg`
    
- `$min`
    
- `$max`
    
- `$count`
    

Example:

```js
{
  $group: {
    _id: "$city",
    total: { $sum: 1 }
  }
}
```

---

# ---------------------------------------------------------

# # **2. When `$` is NOT used**

❌ Do NOT use `$` for normal field names in queries.

Correct:

```js
{ age: 30 }
```

Incorrect:

```js
{ $age: 30 }
```

❌ Do NOT use `$` in simple projections.

Correct:

```js
db.users.find({}, { name: 1, age: 1 })
```

---

# ---------------------------------------------------------

# # **3. Comparison Table (From PPT)**

|Context|Example|Use of `$`|
|---|---|---|
|Query|`{ age: { $gt: 30 } }`|`$gt` = operator|
|Projection|`{ age: 1 }`|No `$`|
|Aggregation|`{ $project: { total: "$salary" } }`|`$salary` = field reference|
|Group|`{ $sum: 1 }`|`$sum` = accumulator|

---

# ---------------------------------------------------------

# # **4. Aggregation Pipeline Optimization Example**

### **Original (NOT optimized)**

```js
{
  $addFields: {
    maxTime: { $max: "$times" },
    minTime: { $min: "$times" }
  }
},
{
  $project: {
    _id: 1,
    name: 1,
    times: 1,
    maxTime: 1,
    minTime: 1,
    avgTime: { $avg: ["$maxTime", "$minTime"] }
  }
},
{
  $match: {
    name: "Joe Schmoe",
    maxTime: { $lt: 20 },
    minTime: { $gt: 5 },
    avgTime: { $gt: 7 }
  }
}
```

---

### ⭐ **Optimized Version**

Push `$match` early (best practice):

```js
{ $match: { name: "Joe Schmoe" } },
{
  $addFields: {
    maxTime: { $max: "$times" },
    minTime: { $min: "$times" }
  }
},
{
  $match: {
    maxTime: { $lt: 20 },
    minTime: { $gt: 5 }
  }
},
{
  $project: {
    _id: 1,
    name: 1,
    times: 1,
    maxTime: 1,
    minTime: 1,
    avgTime: { $avg: ["$maxTime", "$minTime"] }
  }
},
{
  $match: { avgTime: { $gt: 7 } }
}
```

✔ Filtering early reduces pipeline cost.  
✔ `$addFields` applied only to relevant documents.

---

# ---------------------------------------------------------

# # **5. MapReduce in MongoDB (Deprecated)**

MapReduce is still supported but **deprecated**.  
Prefer **aggregation pipelines**.

---

## **Sample Data**

```js
db.orders.insertMany([
  { orderId: 1, cust_id: "C001", price: 200 },
  { orderId: 2, cust_id: "C002", price: 150 },
  { orderId: 3, cust_id: "C001", price: 300 },
  { orderId: 4, cust_id: "C003", price: 400 },
  { orderId: 5, cust_id: "C002", price: 100 },
  { orderId: 6, cust_id: "C001", price: 50 }
]);
```

---

## **Map Function**

```js
var mapFunction1 = function() {
  emit(this.cust_id, this.price);
};
```

`emit(key, value)` produces key–value pairs.

Example outputs:

- ("C001", 200)
    
- ("C002", 150)
    
- ("C001", 300)
    

---

## **Reduce Function**

```js
var reduceFunction1 = function(keyCustId, valuesPrices) {
  return Array.sum(valuesPrices);
};
```

Groupings:

- C001 → [200, 300, 50] = 550
    
- C002 → [150, 100] = 250
    
- C003 → [400] = 400
    

---

## **MapReduce Execution**

```js
db.orders.mapReduce(
  mapFunction1,
  reduceFunction1,
  { out: "map_reduce_example" }
);
```

Output:

```js
[
  { "_id": "C001", "value": 550 },
  { "_id": "C002", "value": 250 },
  { "_id": "C003", "value": 400 }
]
```

---

# ---------------------------------------------------------

# # **6. Aggregation Alternative (Preferred)**

```js
db.orders.aggregate([
  { $group: { _id: "$cust_id", value: { $sum: "$price" } } },
  { $out: "agg_alternative_1" }
]);
```

✔ Easier  
✔ Faster  
✔ Distributed-capable

---

# ---------------------------------------------------------

# # ⭐ **20 MCQs (Questions + Options + Answers)**

Based entirely on the PPT content.

---

### **1. `$` in `{ age: { $gt: 25 } }` represents:**

A) Field name  
B) A reference  
C) An operator  
D) An accumulator  
**Answer: C**

---

### **2. `$` inside aggregation like `{ total: "$salary" }` means:**

A) Multiply salary  
B) Field reference  
C) Create new field  
D) Index operator  
**Answer: B**

---

### **3. `$sum` and `$avg` are examples of:**

A) Query operators  
B) Field names  
C) Accumulators  
D) Input validators  
**Answer: C**

---

### **4. Which query does NOT need `$`?**

A) `{ age: 30 }`  
B) `{ age: { $gt: 30 } }`  
C) `{ price: { $in: [100,200] } }`  
D) `{ $or: [...] }`  
**Answer: A**

---

### **5. Correct use inside projection:**

A) `{ name: "$name" }`  
B) `{ name:1, age:1 }`  
C) `{ $name: 1 }`  
D) `{ $project: "$age" }`  
**Answer: B**

---

### **6. In `$group`, what does `$sum: 1` count?**

A) Field values  
B) Number of documents  
C) Unique values  
D) String length  
**Answer: B**

---

### **7. Optimizing aggregation means:**

A) Adding more `$project` stages  
B) Pushing `$match` earlier  
C) Removing all `$addFields`  
D) Avoiding `$group`  
**Answer: B**

---

### **8. mapReduce in MongoDB is:**

A) Recommended  
B) Faster than aggregation  
C) Deprecated  
D) Required for grouping  
**Answer: C**

---

### **9. In MapReduce, `emit()` is used to:**

A) Insert a document  
B) Emit key–value pairs  
C) Define an index  
D) Sort documents  
**Answer: B**

---

### **10. The `reduce` function receives:**

A) A single document  
B) Only keys  
C) Key and array of values  
D) Whole collection  
**Answer: C**

---

### **11. Which is the aggregation equivalent of MapReduce grouping?**

A) `$project`  
B) `$merge`  
C) `$group`  
D) `$sort`  
**Answer: C**

---

### **12. Which is faster in MongoDB?**

A) mapReduce  
B) Aggregation framework  
C) JavaScript loops  
D) Full table scans  
**Answer: B**

---

### **13. Correct `$project` usage:**

A) `{ $project: {age: "$age"} }`  
B) `{ $project: {"$age": 1} }`  
C) `{ $project: { $age: 1 } }`  
D) `{ $project: { age: "$$age" } }`  
**Answer: A**

---

### **14. In aggregation, `$avg: ["$maxTime","$minTime"]` means:**

A) Create avg field using arithmetic  
B) Divide maxTime by minTime  
C) Reduce fields  
D) Drop fields  
**Answer: A**

---

### **15. Why push `$match` early?**

A) To slow execution  
B) To reduce documents early  
C) To rewrite schema  
D) To remove indexes  
**Answer: B**

---

### **16. In `{ $max: "$times" }`, `$times` refers to:**

A) Number of fields  
B) Name of a collection  
C) Value of the field `times`  
D) Array length  
**Answer: C**

---

### **17. Map function’s `this` keyword refers to:**

A) Global object  
B) Current document  
C) Database connection  
D) Collection name  
**Answer: B**

---

### **18. Aggregation `$out` stage:**

A) Writes results to a new collection  
B) Deletes documents  
C) Prints output  
D) Exports JSON  
**Answer: A**

---

### **19. MapReduce output document structure is:**

A) `{ key: value }`  
B) `{ id: value }`  
C) `{ _id: key, value: sum }`  
D) `{ result: array }`  
**Answer: C**

---

### **20. Prefer aggregation over MapReduce because:**

A) Aggregation is deprecated  
B) Aggregation is faster and native  
C) MapReduce supports more features  
D) Aggregation cannot run in sharded clusters  
**Answer: B**

---

