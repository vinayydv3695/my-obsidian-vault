

---


# # **1. High Availability (HA)**

High Availability means **the system stays operational with minimal downtime**.

### **In MongoDB, HA is achieved through replication:**

- Maintain **multiple copies** of data across different nodes.
    
- If one node fails → another takes over automatically.
    
- Ensures **continuous uptime**, even during:
    
    - Hardware failures
        
    - Software crashes
        
    - Maintenance
        

---

# ---------------------------------------------------------

# # **2. What is Replication in MongoDB?**

Replication = **Synchronizing data across multiple mongod instances**.

### **Replica Set Components**

|Component|Role|
|---|---|
|**Primary**|Accepts all write operations|
|**Secondaries**|Replicate data from primary via oplog|
|**Arbiter (optional)**|Votes in elections but stores no data|

---

# ---------------------------------------------------------

# # **3. Replication Architecture Overview**

- Primary receives all writes.
    
- Updates recorded in the **oplog**.
    
- Secondaries **tail** the oplog and apply changes.
    
- Automatic failover ensures availability.
    

---

# ---------------------------------------------------------

# # **4. Node Failure & Failover**

When primary goes down:

1. Secondaries detect via **heartbeats**.
    
2. They trigger an **election**.
    
3. The **most up-to-date secondary** becomes the new primary.
    
4. Clients automatically redirect writes.
    

This entire process is **automatic**.

---

# ---------------------------------------------------------

# # **5. The MongoDB Oplog**

Oplog = **Operations Log**  
A special **capped collection** that works like a circular buffer.

### **Characteristics**

- Records history of all write operations.
    
- Secondaries read oplog to stay in sync.
    
- Old entries overwritten when capacity is reached.
    
- Enables point-in-time recovery.
    

### Example command from PPT:

```
show collections
db.oplog.rs.find({ ns: "sample_mflix.movies" })
  .sort({ $natural: -1 })
  .limit(5)
```

---

# ---------------------------------------------------------

# # **6. Causes of Replication Lag**

### **1. Network Latency**

Slow communication between nodes → secondary falls behind.

### **2. Disk Throughput Limits**

Secondary disk cannot flush writes fast enough.

### **3. Write Concerns Issues**

Low write concern (e.g., w:1 or unacknowledged writes) →  
secondaries may be unable to keep up with large ingestion.

### **4. Massive Bulk Writes**

Secondary replay speed slows down.

---

# ---------------------------------------------------------

# # **7. Read & Write Concerns**

### **Write Concern**

Defines **how many nodes must acknowledge** a write before success.

Example:

```javascript
db.cats.insertOne(
  { name: 'Mac', color: 'black', age: 6 },
  { writeConcern: { w: 'majority', wtimeout: 3000 } }
)
```

### **Read Concern**

Defines **consistency level** of read results.

### **Set Default RW Concerns**

```javascript
db.adminCommand({
  setDefaultRWConcern: 1,
  defaultReadConcern: { level: 'majority' },
  defaultWriteConcern: { w: 'majority' }
})
```

---


# # **8. Read Preferences**

Define **which replica set member clients read from**.

### **Modes**

- **primary** (default – strongest consistency)
    
- **primaryPreferred**
    
- **secondary**
    
- **secondaryPreferred**
    
- **nearest**
    

### **Connection String Example**

```
mongodb://db0,db1,db2/?replicaSet=myRepl
  &readPreference=secondary
  &maxStalenessSeconds=120
```

---


# # **9. Deploying & Managing Replica Sets**

### **1. Start mongod with replSet config**

### **2. Initialize replica set**

```
rs.initiate()
```

### **3. Add members**

```
rs.add("host:port")
```

### **4. Remove member**

```
rs.remove("host:port")
```

### **5. Check status**

```
rs.status()
```

### **6. Reconfigure**

```
rs.reconfig(cfg)
```

Can modify:

- Priorities
    
- Hidden members
    
- Delayed members
    

---


# ⭐ **20 MCQs Based on MongoDB Replication (with Answers)**

---

### **1. What does High Availability mean in MongoDB?**

A) Faster indexing  
B) Zero disk usage  
C) System remains available despite failures  
D) Unlimited storage  
**Answer: C**

---

### **2. MongoDB achieves HA through:**

A) Sharding only  
B) Replication  
C) Indexing 
D) Backups  
**Answer: B**

---

### **3. A replica set is:**

A) A sharded cluster  
B) A group of mongod instances with the same dataset  
C) A backup archive  
D) A transaction log  
**Answer: B**

---

### **4. Which node accepts writes?**

A) Secondary  
B) Arbiter  
C) Primary  
D) Hidden node  
**Answer: C**

---

### **5. Which node votes but stores no data?**

A) Primary  
B) Secondary  
C) Hidden  
D) Arbiter  
**Answer: D**

---

### **6. Failover occurs when:**

A) Indexes are rebuilt  
B) Secondary goes offline  
C) Primary fails  
D) Cache is cleared  
**Answer: C**

---

### **7. Replication in MongoDB is based on:**

A) Binary logs  
B) Write-ahead logging  
C) Oplog (capped collection)  
D) Snapshotting  
**Answer: C**

---

### **8. The oplog is stored in:**

A) admin database  
B) local database  
C) config database  
D) user database  
**Answer: B**

---

### **9. What causes replication lag?**

A) Excessive indexes only  
B) Network latency, slow disks, low write concern  
C) Reads from secondary  
D) More hidden nodes  
**Answer: B**

---

### **10. Write Concern "majority" means:**

A) A write is unacknowledged  
B) Only primary acknowledges  
C) Majority of replica set nodes acknowledge  
D) Secondaries ignore write  
**Answer: C**

---

### **11. Which read preference provides strongest consistency?**

A) secondary  
B) nearest  
C) primary  
D) secondaryPreferred  
**Answer: C**

---

### **12. A secondary node reads data from:**

A) Client directly  
B) Other secondaries  
C) The primary’s oplog  
D) Sharded router  
**Answer: C**

---

### **13. Which read preference allows reading from secondary but prefers primary?**

A) primary  
B) secondaryPreferred  
C) primaryPreferred  
D) nearest  
**Answer: C**

---

### **14. Replication lag increases when:**

A) Using majority write concern  
B) Disk on secondary is slower than primary  
C) Arbiter becomes secondary  
D) Indexes are removed  
**Answer: B**

---

### **15. rs.status() is used to:**

A) Start replica set  
B) Remove primary  
C) Check health of replica set  
D) Configure sharding  
**Answer: C**

---

### **16. rs.add() is used for:**

A) Adding new databases  
B) Adding a new collection  
C) Adding a new replica set member  
D) Adding oplog entries manually  
**Answer: C**

---

### **17. Which parameter controls read consistency?**

A) readWriteConcern  
B) readMode  
C) readConcern  
D) readIsolation  
**Answer: C**

---

### **18. Hidden members are used for:**

A) Failover  
B) Analytics queries without affecting primary  
C) Accepting writes  
D) Voting only  
**Answer: B**

---

### **19. Arbiter nodes are used when:**

A) You need more storage  
B) You want to reduce election time  
C) You need an extra vote without storing data  
D) You want more secondaries  
**Answer: C**

---

### **20. maxStalenessSeconds is used in:**

A) Write concerns  
B) Read preferences  
C) Backup configuration  
D) Profiling  
**Answer: B**

---

