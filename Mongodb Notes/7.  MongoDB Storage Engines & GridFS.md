


---

# ## 1. What is a Storage Engine?

A **storage engine** controls how MongoDB stores data **on disk** and **in memory**.

### **Key responsibilities**

- Data layout on disk
    
- Index management
    
- Compression
    
- Concurrency control
    
- Crash recovery
    

### **Default Storage Engine**

- **WiredTiger** (WT)
    

---

# ## 2. WiredTiger — Overview

WiredTiger is the **default MongoDB storage engine** and provides:

### **Features**

- **Document-level concurrency**
    
    - Multiple writes can occur without blocking each other
        
- **Checkpointing**
    
    - Ensures crash consistency
        
- **Compression**
    
    - Uses **Snappy** for data & journal compression
        

---

# ## 3. Enterprise Edition Enhancements

MongoDB Enterprise Edition adds:

### **1. Encryption at Rest**

- Data is encrypted when MongoDB (`mongod`) stops
    
- Protects data files on disk
    

### **2. In-Memory Storage Engine**

- Stores data **entirely in RAM**
    
- Ultra-low latency
    
- Good for real-time analytics
    
- **Does not persist data** to disk
    

---

# ## 4. Storage Engine Architecture — Example

A **hybrid deployment** may include:

- **WiredTiger nodes** (disk-based) for durability
    
- **In-memory nodes** for high-speed querying
    

Query pattern:

- Reads served from in-memory nodes
    
- Writes saved to WT nodes for persistence
    

---

# ## 5. Journaling — Essentials

Journaling ensures **durability** in case of failure.

### **How it works**

- Uses **Write-Ahead Logging (WAL)**
    
- Changes are written first to **journal files**, then applied to data files
    

### **Journal File Details**

- Max size: **100 MB**
    
- Naming format: `WiredTigerLog.<sequenceNumber>`
    
- Compressed using **Snappy**
    

---

# ## 6. Checkpoints & Crash Recovery

### **Checkpoints**

- Periodic **snapshots** of the database
    
- Save consistent state
    

### **Crash Recovery Flow**

1. WT loads last checkpoint
    
2. Journal is replayed
    
3. Database returns to consistent state
    

---

# ## 7. Journaling in In-Memory Engine

Because the in-memory engine does **not** write to disk:

- **No journal files**
    
- **No checkpointing**
    
- On crash → **Rollback** occurs (data loss possible)
    

---

# ## 8. GridFS — Overview

GridFS is MongoDB’s system for storing **large files**.

### **Why GridFS?**

MongoDB BSON documents have a **16 MB limit**.  
GridFS splits large files into **chunks** (default **255 KB**).

### **Created Collections**

- `fs.files` → metadata
    
- `fs.chunks` → binary data chunks
    

---

# ## 9. GridFS Features & Usage

### **Advantages**

- Stores large files inside MongoDB
    
- Good for distributed deployments
    
- Metadata stored alongside file
    

### **Limitations**

- Not atomic for large file writes
    
- Not ideal for files **smaller than 16 MB**
    
- Slower for high-read/write workloads
    

---

# ## 10. Using `mongofiles` Utility

### Upload a file:

```
mongofiles -d=videos put file.mp4
```

### List files:

```
mongofiles -d=videos list
```

### Retrieve file:

```
mongofiles -d=videos get file.mp4
```

### Delete file:

```
mongofiles -d=videos delete file.mp4
```

---

# ## 11. Real-World GridFS Use Cases

- Government systems → secure file storage
    
- Hospitals → medical imaging (DICOM files)
    
- Document archival systems
    
- EdTech → video hosting & learning materials
    
- Startups avoiding early S3/cloud complexity
    

---

# ## 12. Journaling vs Oplog (Summary)

### **Journaling**

- Ensures **durability**
    
- Used for **crash recovery**
    
- Local to each node
    

### **Oplog**

- Used for **replication**
    
- Shared across replica set
    
- Enables eventual consistency
    

---

# ## 13. Summary & Key Takeaways

- **WiredTiger** → default engine offering compression, concurrency, durability
    
- **Enterprise Edition** → encryption & in-memory engine
    
- **Journaling** → essential for crash consistency
    
- **GridFS** → stores files > 16MB using chunks
    
- **In-memory engine** → fastest but volatile
    

---

# ----------------------------------------------------

# ⭐ **20 MCQs 

---

### **1. What is the default MongoDB storage engine?**

A) MMAPv1  
B) RocksDB  
C) WiredTiger  
D) In-Memory  
**Answer: C**

---

### **2. WiredTiger provides which concurrency feature?**

A) Collection-level concurrency  
B) Document-level concurrency  
C) No concurrency  
D) Table-level locking  
**Answer: B**

---

### **3. The compression library used by WiredTiger is:**

A) Zlib  
B) Brotli  
C) Snappy  
D) LZ4  
**Answer: C**

---

### **4. Encryption at rest is available in:**

A) Community Edition  
B) Free version only  
C) Enterprise Edition  
D) Compass-only builds  
**Answer: C**

---

### **5. The in-memory engine stores data:**

A) Only on disk  
B) In RAM only  
C) In cache + disk  
D) In cloud storage  
**Answer: B**

---

### **6. What is the size limit of WiredTiger journal files?**

A) 10 MB  
B) 50 MB  
C) 100 MB  
D) Unlimited  
**Answer: C**

---

### **7. Journal files use which naming format?**

A) journal_.log  
B) mongoLog.  
C) WTJournal.  
D) WiredTigerLog.  
**Answer: D**

---

### **8. On crash recovery, MongoDB:**

A) Discards all data  
B) Only loads journal  
C) Loads checkpoint + replays journal  
D) Requires manual repair  
**Answer: C**

---

### **9. The in-memory storage engine does NOT support:**

A) RAM usage  
B) High performance  
C) Journaling  
D) Reads  
**Answer: C**

---

### **10. GridFS is used to store files larger than:**

A) 1 MB  
B) 10 MB  
C) 16 MB  
D) 100 MB  
**Answer: C**

---

### **11. The default chunk size in GridFS is:**

A) 128 KB  
B) 255 KB  
C) 1 MB  
D) 4 MB  
**Answer: B**

---

### **12. GridFS stores file metadata in:**

A) fs.data  
B) fs.chunks  
C) fs.files  
D) fs.meta  
**Answer: C**

---

### **13. Which command uploads a file using mongofiles?**

A) mongofiles push file  
B) mongofiles upload file  
C) mongofiles put file.mp4  
D) mongofiles add file  
**Answer: C**

---

### **14. Which is a limitation of GridFS?**

A) Cannot store metadata  
B) Only stores small files  
C) Non-atomic writes for large files  
D) Only works on macOS  
**Answer: C**

---

### **15. Oplog is used for:**

A) Crash recovery  
B) File storage  
C) Replication  
D) Encryption  
**Answer: C**

---

### **16. WiredTiger checkpoints are used for:**

A) Backup only  
B) Crash consistency  
C) Index rebuilds  
D) File splitting  
**Answer: B**

---

### **17. In-memory engine crash results in:**

A) Full recovery  
B) Journal replay  
C) Possible data loss  
D) Automatic disk flush  
**Answer: C**

---

### **18. Which engine is best for ultra-low latency?**

A) WiredTiger  
B) MMAPv1  
C) In-memory  
D) RocksDB  
**Answer: C**

---

### **19. Government and hospital apps commonly use:**

A) GridFS  
B) Local file system  
C) Redis  
D) PostgreSQL  
**Answer: A**

---

### **20. Compression in WiredTiger improves:**

A) Query language  
B) Data durability  
C) Storage efficiency  
D) Authentication  
**Answer: C**

---

